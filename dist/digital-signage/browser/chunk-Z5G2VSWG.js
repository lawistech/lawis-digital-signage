import{a as me}from"./chunk-7EIHC7WG.js";import{a as ce}from"./chunk-2TM6U6BO.js";import{b as pe}from"./chunk-3SNT5TZL.js";import{b as Q,d as q,e as oe,f as se,g as H,h as le,p as de,s as z}from"./chunk-PCHI4UW3.js";import"./chunk-6VCTTBHM.js";import"./chunk-WBRTOA2C.js";import{i as re,m as R}from"./chunk-LPDC563P.js";import{$ as E,A as $,Ab as V,Cb as F,Eb as ie,F as L,Hb as b,Ib as S,La as Y,N as X,Na as l,O as B,Oa as j,R as W,W as J,Za as f,ab as w,c as I,db as Z,eb as x,f as O,g as K,ha as d,hb as ee,ia as c,ib as te,jb as r,kb as n,kc as ne,lb as P,mb as y,mc as N,na as D,nb as g,o as A,ob as m,tb as ae,ub as o,vb as C,wb as M,yb as T,zb as k}from"./chunk-URYE4ZYK.js";import"./chunk-X5YLR3NI.js";import{a as _,b as v}from"./chunk-ODN5LVDJ.js";var xe={areas:[],selectedArea:null,loading:!1,error:null},ue=(()=>{class i{constructor(){this.state=new K(xe)}selectAreas(){return new I(e=>{this.state.subscribe(a=>e.next(a.areas))})}selectSelectedArea(){return new I(e=>{this.state.subscribe(a=>e.next(a.selectedArea))})}selectLoading(){return new I(e=>{this.state.subscribe(a=>e.next(a.loading))})}selectError(){return new I(e=>{this.state.subscribe(a=>e.next(a.error))})}setAreas(e){this.state.next(v(_({},this.state.value),{areas:e}))}setSelectedArea(e){this.state.next(v(_({},this.state.value),{selectedArea:e}))}addArea(e){this.state.next(v(_({},this.state.value),{areas:[...this.state.value.areas,e]}))}updateArea(e,a){this.state.next(v(_({},this.state.value),{areas:this.state.value.areas.map(t=>t.id===e?_(_({},t),a):t)}))}removeArea(e){this.state.next(v(_({},this.state.value),{areas:this.state.value.areas.filter(a=>a.id!==e)}))}setLoading(e){this.state.next(v(_({},this.state.value),{loading:e}))}setError(e){this.state.next(v(_({},this.state.value),{error:e}))}getAreaById(e){return this.state.value.areas.find(a=>a.id===e)}static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275prov=W({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var G=(()=>{class i{constructor(e,a){this.areaService=e,this.areaState=a,this.areas$=this.areaState.selectAreas(),this.selectedArea$=this.areaState.selectSelectedArea(),this.loading$=this.areaState.selectLoading(),this.error$=this.areaState.selectError(),this.realtimeChannel=null,this.setupRealtimeSubscription()}loadAreas(){this.areaState.setLoading(!0),this.areaService.getAreas().pipe(B(e=>this.areaState.setAreas(e)),$(e=>{throw this.areaState.setError(e.message),e}),L(()=>this.areaState.setLoading(!1))).subscribe()}createArea(e){return this.areaState.setLoading(!0),this.areaService.createArea(e).pipe(B(a=>{this.areaState.addArea(a)}),$(a=>{throw this.areaState.setError(a.message),a}),L(()=>this.areaState.setLoading(!1)))}updateArea(e,a){return this.areaState.setLoading(!0),this.areaService.updateArea(e,a).pipe(B(t=>{this.areaState.updateArea(e,t)}),$(t=>{throw this.areaState.setError(t.message),t}),L(()=>this.areaState.setLoading(!1)))}deleteArea(e){return this.areaState.setLoading(!0),this.areaService.deleteArea(e).pipe(B(()=>{this.areaState.removeArea(e)}),$(a=>{throw this.areaState.setError(a.message),a}),L(()=>this.areaState.setLoading(!1)))}toggleAreaStatus(e){let a=this.areaState.getAreaById(e);if(a){let t=a.status==="active"?"inactive":"active";this.updateArea(e,{status:t}).subscribe()}}getActiveAreasCount(){return this.areas$.pipe(A(e=>e.filter(a=>a.status==="active").length))}getTotalScreensCount(){return this.areas$.pipe(A(e=>e.reduce((a,t)=>a+t.stats.totalScreens,0)))}getOnlineScreensCount(){return this.areas$.pipe(A(e=>e.reduce((a,t)=>a+t.stats.onlineScreens,0)))}setupRealtimeSubscription(){this.realtimeChannel=this.areaService.subscribeToUpdates(e=>{e&&(this.areaState.getAreaById(e.id)?this.areaState.updateArea(e.id,e):this.areaState.addArea(e))})}cleanup(){this.realtimeChannel&&(this.areaService.unsubscribeFromUpdates(this.realtimeChannel),this.realtimeChannel=null)}selectArea(e){this.areaState.setSelectedArea(e)}clearSelectedArea(){this.areaState.setSelectedArea(null)}getAreasByStatus(e){return this.areas$.pipe(A(a=>a.filter(t=>t.status===e)))}clearError(){this.areaState.setError(null)}static{this.\u0275fac=function(a){return new(a||i)(J(ce),J(ue))}}static{this.\u0275prov=W({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Ce=i=>["/areas",i];function be(i,p){if(i&1){let e=y();r(0,"div",9)(1,"button",18),g("click",function(t){d(e);let s=m();return c(s.onEdit(t))}),r(2,"span",19),o(3,"edit"),n(),o(4," Edit Area "),n(),r(5,"button",18),g("click",function(t){d(e);let s=m();return c(s.onToggleStatus(t))}),r(6,"span",19),o(7),n(),o(8),n(),r(9,"button",20),g("click",function(t){d(e);let s=m();return c(s.onDelete(t))}),r(10,"span",21),o(11,"delete"),n(),o(12," Delete Area "),n()()}if(i&2){let e=m();l(7),M(" ",e.area.status==="active"?"pause_circle":"play_circle"," "),l(),M(" ",e.area.status==="active"?"Deactivate":"Activate"," ")}}function Se(i,p){if(i&1&&(r(0,"div",17)(1,"span",13),o(2,"playlist_play"),n(),r(3,"span",22),o(4),n()()),i&2){let e=m();l(4),C(e.area.stats.activePlaylist)}}var he=(()=>{class i{constructor(e){this.areaFacade=e,this.edit=new D,this.delete=new D,this.showMenu=!1,this.destroy$=new O}ngOnInit(){this.areaFacade.areas$.pipe(X(this.destroy$)).subscribe(e=>{let a=e.find(t=>t.id===this.area.id);a&&(this.area=a)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}toggleMenu(e){e.preventDefault(),e.stopPropagation(),this.showMenu=!this.showMenu}onEdit(e){e.preventDefault(),e.stopPropagation(),this.showMenu=!1,this.edit.emit(this.area)}onToggleStatus(e){e.preventDefault(),e.stopPropagation(),this.showMenu=!1,this.areaFacade.toggleAreaStatus(this.area.id)}onDelete(e){e.preventDefault(),e.stopPropagation(),this.showMenu=!1,confirm("Are you sure you want to delete this area?")&&this.delete.emit(this.area.id)}onClickOutside(){this.showMenu&&(this.showMenu=!1)}static{this.\u0275fac=function(a){return new(a||i)(j(G))}}static{this.\u0275cmp=E({type:i,selectors:[["app-area-card"]],hostBindings:function(a,t){a&1&&g("click",function(){return t.onClickOutside()},!1,Y)},inputs:{area:"area"},outputs:{edit:"edit",delete:"delete"},standalone:!0,features:[F],decls:24,vars:12,consts:[[1,"group","relative","bg-white","rounded-xl","border","border-gray-100","shadow-lg","hover:shadow-xl","transition-all","duration-300"],[1,"block","p-5","cursor-pointer",3,"routerLink"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","items-center","space-x-2"],[1,"w-2","h-2","rounded-full",3,"title"],[1,"text-lg","font-medium","text-gray-900"],[1,"relative"],["title","More options",1,"p-1.5","text-gray-400","hover:text-gray-600","transition-colors","rounded-full","hover:bg-gray-50",3,"click"],[1,"material-icons","text-lg"],[1,"absolute","right-0","mt-1","w-48","rounded-lg","bg-white","shadow-lg","border","border-gray-100","py-1","z-10"],[1,"text-sm","text-gray-500","mb-4"],[1,"flex","items-center","justify-between"],[1,"flex","items-center"],[1,"material-icons","text-gray-400","mr-1"],[1,"text-sm"],[1,"font-medium"],[1,"text-gray-500"],[1,"flex","items-center","text-sm","text-gray-500"],[1,"w-full","px-4","py-2","text-sm","text-gray-700","hover:bg-gray-50","flex","items-center",3,"click"],[1,"material-icons","text-lg","mr-2","text-gray-400"],[1,"w-full","px-4","py-2","text-sm","text-red-600","hover:bg-red-50","flex","items-center",3,"click"],[1,"material-icons","text-lg","mr-2"],[1,"truncate","max-w-[150px]"]],template:function(a,t){a&1&&(r(0,"div",0)(1,"a",1)(2,"div",2)(3,"div",3),P(4,"div",4),r(5,"h3",5),o(6),n()(),r(7,"div",6)(8,"button",7),g("click",function(u){return t.toggleMenu(u)}),r(9,"span",8),o(10,"more_vert"),n()(),f(11,be,13,2,"div",9),n()(),r(12,"p",10),o(13),n(),r(14,"div",11)(15,"div",12)(16,"span",13),o(17,"devices"),n(),r(18,"span",14)(19,"span",15),o(20),n(),r(21,"span",16),o(22),n()()(),f(23,Se,5,1,"div",17),n()()()),a&2&&(l(),w("routerLink",ie(10,Ce,t.area.id)),l(3),Z(t.area.status==="active"?"bg-green-500":"bg-gray-300"),w("title",t.area.status==="active"?"Online":"Offline"),l(2),C(t.area.name),l(5),x(t.showMenu?11:-1),l(2),C(t.area.location),l(7),C(t.area.stats.onlineScreens),l(2),M("/",t.area.stats.totalScreens," online"),l(),x(t.area.stats.activePlaylist?23:-1))},dependencies:[N,R,re],encapsulation:2})}}return i})();var fe=(()=>{class i{constructor(){this.next=new D,this.onCancel=new D,this.areaData={name:"",location:"",description:""}}onSubmit(){this.areaData.name&&this.areaData.location&&this.next.emit(this.areaData)}static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275cmp=E({type:i,selectors:[["app-area-name-dialog"]],outputs:{next:"next",onCancel:"onCancel"},standalone:!0,features:[F],decls:24,vars:4,consts:[["form","ngForm"],[1,"fixed","inset-0","bg-gray-600","bg-opacity-50","flex","items-center","justify-center","z-50"],[1,"bg-white","rounded-lg","shadow-xl","p-6","w-full","max-w-md"],[1,"text-xl","font-semibold","mb-4"],[3,"ngSubmit"],[1,"space-y-4"],["for","name",1,"block","text-sm","font-medium","text-gray-700"],["type","text","id","name","name","name","required","","placeholder","Enter area name (e.g., Main Lobby, Cafeteria)",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-blue-500","focus:ring-blue-500",3,"ngModelChange","ngModel"],["for","building",1,"block","text-sm","font-medium","text-gray-700"],["type","text","id","building","name","building","required","","placeholder","Enter building name",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-blue-500","focus:ring-blue-500",3,"ngModelChange","ngModel"],["for","description",1,"block","text-sm","font-medium","text-gray-700"],["id","description","name","description","rows","3","placeholder","Enter area description",1,"mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-blue-500","focus:ring-blue-500",3,"ngModelChange","ngModel"],[1,"mt-6","flex","justify-end","space-x-3"],["type","button",1,"px-4","py-2","border","border-gray-300","rounded-md","text-sm","font-medium","text-gray-700","hover:bg-gray-50",3,"click"],["type","submit",1,"px-4","py-2","bg-blue-600","text-white","rounded-md","text-sm","font-medium","hover:bg-blue-700","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"]],template:function(a,t){if(a&1){let s=y();r(0,"div",1)(1,"div",2)(2,"h2",3),o(3,"Create New Area"),n(),r(4,"form",4,0),g("ngSubmit",function(){return d(s),c(t.onSubmit())}),r(6,"div",5)(7,"div")(8,"label",6),o(9,"Area Name *"),n(),r(10,"input",7),V("ngModelChange",function(h){return d(s),k(t.areaData.name,h)||(t.areaData.name=h),c(h)}),n()(),r(11,"div")(12,"label",8),o(13,"Building *"),n(),r(14,"input",9),V("ngModelChange",function(h){return d(s),k(t.areaData.location,h)||(t.areaData.location=h),c(h)}),n()(),r(15,"div")(16,"label",10),o(17,"Description"),n(),r(18,"textarea",11),V("ngModelChange",function(h){return d(s),k(t.areaData.description,h)||(t.areaData.description=h),c(h)}),n()()(),r(19,"div",12)(20,"button",13),g("click",function(){return d(s),c(t.onCancel.emit())}),o(21," Cancel "),n(),r(22,"button",14),o(23," Next "),n()()()()()}if(a&2){let s=ae(5);l(10),T("ngModel",t.areaData.name),l(4),T("ngModel",t.areaData.location),l(4),T("ngModel",t.areaData.description),l(4),w("disabled",!s.form.valid)}},dependencies:[N,z,le,Q,q,oe,de,H,se],encapsulation:2})}}return i})();var we=(i,p)=>p.id;function ye(i,p){i&1&&(r(0,"div",15)(1,"div",18)(2,"span",19),o(3,"error"),n(),o(4),n()()),i&2&&(l(4),M(" ",p," "))}function Ae(i,p){i&1&&(r(0,"div",16)(1,"div",20),P(2,"div",21),n()())}function Ee(i,p){i&1&&(r(0,"p",25),o(1,"Try adjusting your search criteria"),n())}function De(i,p){i&1&&(r(0,"p",25),o(1,"Create your first area to get started"),n())}function Me(i,p){if(i&1&&(r(0,"div",16)(1,"div",22)(2,"span",23),o(3,"dashboard"),n(),r(4,"h3",24),o(5,"No areas found"),n(),f(6,Ee,2,0,"p",25)(7,De,2,0,"p",25),n()()),i&2){let e=m(2);l(6),x(e.searchQuery?6:7)}}function Te(i,p){if(i&1){let e=y();r(0,"app-area-card",28),g("edit",function(t){d(e);let s=m(3);return c(s.editArea(t))})("delete",function(t){d(e);let s=m(3);return c(s.deleteArea(t))}),n()}if(i&2){let e=p.$implicit;w("area",e)}}function ke(i,p){if(i&1&&(r(0,"div",16)(1,"div",26),ee(2,Te,1,1,"app-area-card",27,we),b(4,"async"),n()()),i&2){let e=m(2);l(2),te(S(4,0,e.filteredAreas$))}}function Ve(i,p){if(i&1&&(f(0,Me,8,1,"div",16),b(1,"async"),f(2,ke,5,2,"div",16)),i&2){let e,a=m();x(((e=S(1,1,a.filteredAreas$))==null?null:e.length)===0?0:2)}}function Fe(i,p){if(i&1){let e=y();r(0,"app-area-name-dialog",29),g("next",function(t){d(e);let s=m();return c(s.onNameDialogNext(t))})("onCancel",function(){d(e);let t=m();return c(t.closeDialogs())}),n()}}function Ne(i,p){if(i&1){let e=y();r(0,"app-area-screens-dialog",30),g("createArea",function(t){d(e);let s=m();return c(s.onCreateArea(t))})("back",function(){d(e);let t=m();return t.showScreensDialog=!1,c(t.showNameDialog=!0)}),n()}if(i&2){let e=m();w("areaData",e.tempAreaData)("availableScreens",e.availableScreens)}}var dt=(()=>{class i{constructor(e,a){this.areaFacade=e,this.screenService=a,this.areas$=this.areaFacade.areas$,this.loading$=this.areaFacade.loading$,this.error$=this.areaFacade.error$,this.activeAreasCount$=this.areaFacade.getActiveAreasCount(),this.totalScreensCount$=this.areaFacade.getTotalScreensCount(),this.onlineScreensCount$=this.areaFacade.getOnlineScreensCount(),this.searchQuery="",this.showNameDialog=!1,this.showScreensDialog=!1,this.tempAreaData=null,this.availableScreens=[],this.destroy$=new O,this.filteredAreas$=this.areas$.pipe(A(t=>{let s=this.searchQuery.toLowerCase();return t.filter(u=>u.name.toLowerCase().includes(s)||u.location.toLowerCase().includes(s)||u.description?.toLowerCase().includes(s))}))}ngOnInit(){this.areaFacade.loadAreas(),this.loadAvailableScreens()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}openCreateDialog(){this.showNameDialog=!0}closeDialogs(){this.showNameDialog=!1,this.showScreensDialog=!1,this.tempAreaData=null}loadAvailableScreens(){this.screenService.getScreens().subscribe(e=>{this.availableScreens=e.filter(a=>!a.area_id)})}onNameDialogNext(e){this.tempAreaData=e,this.showNameDialog=!1,this.showScreensDialog=!0}onCreateArea(e){if(!e.name||!e.location){console.error("Missing required area data");return}let a=e.screenIds||[],t={name:e.name,description:e.description,location:e.location,screenIds:a};console.log("Creating area with data:",t),this.areaFacade.createArea(t).subscribe({next:()=>{this.closeDialogs(),this.loadAvailableScreens()},error:s=>{console.error("Error creating area:",s)}})}editArea(e){console.log("Editing area:",e)}deleteArea(e){confirm("Are you sure you want to delete this area?")&&this.areaFacade.deleteArea(e).subscribe({next:()=>{this.loadAvailableScreens()},error:a=>{console.error("Error deleting area:",a)}})}static{this.\u0275fac=function(a){return new(a||i)(j(G),j(pe))}}static{this.\u0275cmp=E({type:i,selectors:[["app-areas"]],standalone:!0,features:[F],decls:44,vars:21,consts:[[1,"min-h-screen","bg-gray-50"],[1,"max-w-7xl","mx-auto","bg-white","rounded-xl","shadow-sm","p-6","mb-6"],[1,"flex","flex-col","md:flex-row","justify-between","items-start","md:items-center","gap-4"],[1,"text-2xl","font-semibold","text-gray-900"],[1,"mt-1","text-sm","text-gray-500"],[1,"flex","flex-col","sm:flex-row","w-full","md:w-auto","gap-3"],[1,"relative","flex-grow","sm:max-w-xs"],["type","text","placeholder","Search areas...",1,"w-full","pl-10","pr-4","py-2","border","border-gray-200","rounded-lg","text-sm","focus:outline-none","focus:ring-2","focus:ring-blue-100","focus:border-blue-200","transition-colors",3,"ngModelChange","ngModel"],[1,"material-icons","absolute","left-3","top-2.5","text-gray-400","text-sm"],[1,"flex","items-center","justify-center","px-4","py-2","bg-blue-50","text-blue-600","rounded-lg","hover:bg-blue-100","transition-colors","text-sm","font-medium","shadow-lg",3,"click"],[1,"material-icons","text-sm","mr-2"],[1,"max-w-7xl","mx-auto","grid","grid-cols-1","md:grid-cols-3","gap-6","mb-6"],[1,"bg-white","rounded-lg","shadow-sm","p-6"],[1,"text-sm","font-medium","text-gray-500","mb-2"],[1,"text-2xl","font-semibold"],[1,"max-w-7xl","mx-auto","mb-6"],[1,"max-w-7xl","mx-auto","px-4","py-6"],[3,"areaData","availableScreens"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","flex","items-center","text-red-700"],[1,"material-icons","mr-2"],[1,"flex","items-center","justify-center","py-12"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-600"],[1,"bg-white","rounded-xl","p-8","text-center"],[1,"material-icons","text-4xl","text-gray-400","mb-2"],[1,"text-lg","font-medium","text-gray-900","mb-1"],[1,"text-gray-500"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[3,"area"],[3,"edit","delete","area"],[3,"next","onCancel"],[3,"createArea","back","areaData","availableScreens"]],template:function(a,t){if(a&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h1",3),o(5,"Resay Digital Signage"),n(),r(6,"p",4),o(7,"Manage your displays and content"),n()(),r(8,"div",5)(9,"div",6)(10,"input",7),V("ngModelChange",function(u){return k(t.searchQuery,u)||(t.searchQuery=u),u}),n(),r(11,"span",8),o(12,"search"),n()(),r(13,"button",9),g("click",function(){return t.openCreateDialog()}),r(14,"span",10),o(15,"add"),n(),o(16," Add Area "),n()()()(),r(17,"div",11)(18,"div",12)(19,"h3",13),o(20,"Active Areas"),n(),r(21,"p",14),o(22),b(23,"async"),n()(),r(24,"div",12)(25,"h3",13),o(26,"Total Screens"),n(),r(27,"p",14),o(28),b(29,"async"),n()(),r(30,"div",12)(31,"h3",13),o(32,"Online Screens"),n(),r(33,"p",14),o(34),b(35,"async"),n()()(),f(36,ye,5,1,"div",15),b(37,"async"),f(38,Ae,3,0,"div",16),b(39,"async"),f(40,Ve,3,3),b(41,"async"),f(42,Fe,1,0,"app-area-name-dialog")(43,Ne,1,2,"app-area-screens-dialog",17),n()),a&2){let s;l(10),T("ngModel",t.searchQuery),l(12),C(S(23,9,t.activeAreasCount$)),l(6),C(S(29,11,t.totalScreensCount$)),l(6),C(S(35,13,t.onlineScreensCount$)),l(2),x((s=S(37,15,t.error$))?36:-1,s),l(2),x(S(39,17,t.loading$)?38:-1),l(2),x(S(41,19,t.loading$)?-1:40),l(2),x(t.showNameDialog?42:-1),l(),x(t.showScreensDialog&&t.tempAreaData?43:-1)}},dependencies:[N,ne,R,z,Q,q,H,he,fe,me],encapsulation:2})}}return i})();export{dt as AreasComponent};
