import{a as o}from"./chunk-WBRTOA2C.js";import{h as p}from"./chunk-LPDC563P.js";import{A as a,R as l,W as g,g as c,j as i,o as n}from"./chunk-URYE4ZYK.js";import{i as h}from"./chunk-ODN5LVDJ.js";var S=(()=>{class u{constructor(t){this.router=t,this.userSubject=new c(null),this.user$=this.userSubject.asObservable(),this.loadUser(),o.auth.onAuthStateChange((e,r)=>{let s=r?.user??null;if(this.userSubject.next(s),e==="SIGNED_OUT")this.router.navigate(["/auth/login"]);else if(e==="SIGNED_IN"){let d=localStorage.getItem("returnUrl")||"/";localStorage.removeItem("returnUrl"),this.router.navigate([d])}})}loadUser(){return h(this,null,function*(){try{let{data:{session:t}}=yield o.auth.getSession();this.userSubject.next(t?.user??null)}catch(t){console.error("Error loading user:",t),this.userSubject.next(null)}})}signIn(t,e){return i(o.auth.signInWithPassword({email:t,password:e})).pipe(n(({data:{session:r},error:s})=>{if(s)throw s;return r}),a(r=>{throw console.error("Error signing in:",r),r}))}signUp(t,e){return i(o.auth.signUp({email:t,password:e,options:{emailRedirectTo:`${window.location.origin}/auth/callback`}})).pipe(n(({data:{session:r},error:s})=>{if(s)throw s;return r}),a(r=>{throw console.error("Error signing up:",r),r}))}resetPassword(t){return i(o.auth.resetPasswordForEmail(t,{redirectTo:`${window.location.origin}/auth/reset-password`})).pipe(n(({error:e})=>{if(e)throw e}),a(e=>{throw console.error("Error resetting password:",e),e}))}handleAuthCallback(t,e){return i(o.auth.setSession({access_token:t,refresh_token:e})).pipe(n(({error:r})=>{if(r)throw r}),a(r=>{throw console.error("Error handling auth callback:",r),r}))}signOut(){return i(o.auth.signOut()).pipe(n(({error:t})=>{if(t)throw t;this.userSubject.next(null),this.router.navigate(["/auth/login"])}),a(t=>{throw console.error("Error during sign out:",t),t}))}getCurrentUser(){return this.userSubject.value}isAuthenticated(){return!!this.userSubject.value}saveReturnUrl(t){t&&t!=="/auth/login"&&!t.startsWith("/auth/")&&localStorage.setItem("returnUrl",t)}static{this.\u0275fac=function(e){return new(e||u)(g(p))}}static{this.\u0275prov=l({token:u,factory:u.\u0275fac,providedIn:"root"})}}return u})();export{S as a};
